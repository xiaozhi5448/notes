# 科学上网指南

### 认识并安装shadowsocks

----

```shell
sudo yum install python-pip
sudo pip install shadowsocks
```

两条命令执行完成后，会安装ssserver与sslocal两个工具，ssserver运行在服务端，sslocal运行在客户端，服务端配置文件如下

```json
{  
    "server":"my ip",  
    "server_port":myport,  
    "local_port":1080,  
    "password":"my password",  
    "timeout":600,  
    "method":"aes-256-cfb"  
}
```

随后在服务端执行ssserver

```shell
ssserver -c config.json -d start #也可以在命令行直接指定运行参数
```

客户端配置文件

```json
{
    "server":"123.207.251.52",
    "server_port":23456,
    "local_port":1080
    "password":"w158en239",
    "method":"aes-256-cfb",
    "remarks":""
}
```

在客户端执行

```shell
sslocal -c config.json -d start
```

可以看到sslocal监听在本机1080端口

```shell
$ netstat -tnlp | grep 1080
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
tcp        0      0 127.0.0.1:1080          0.0.0.0:*               LISTEN      -    
```

在google浏览器中使用switchomega插件，设置google代理后，可以通过google浏览器访问外网

可以编写一条命令脚本放入/etc/init.d/目录下，实现开机自启动

```shell
$ cat /etc/init.d/sslocal 
#!/bin/bash
sudo sslocal -c /home/xiaozhi/config/tengxunyun.json -b 0.0.0.0 -d start
```





### 使用proxychains代理终端网络请求

----

安装proxychains，在deepin中可以直接通过aptget进行安装，而在centos中要通过github源码编译安装，安装完成后，在/etc/目录下拷贝一份配置文件，在配置文件的最后一行添加socks代理

```shell
socks5  127.0.0.1	1080 # 配置文件中有用例说明
```

使用时，在需要使用代理的命令前，加上proxychains即可， 如

```shell
proxychains curl www.google.com
```



### 使用privoxy将socks代理转变为http代理

----

privoxy直接使用apt命令安装即可，如果软件源中没有，也可以获取github源码后自己编译安装。安装完成后默认配置文件位于

/etc/privoxy/config，编辑该文件，加入如下内容

```shell
forward-socks5	/	127.0.0.1:1080	. # socks代理地址
listen-address 127.0.0.1:8118   # 本地监听地址
forward 192.168.*.*/	.   # 私有IP地址直连
forward 127.*.*.*/	.        # 私有IP地址直连
```

在使用http代理时，可以设置http_proxy环境变量，但是每次使用都设置环境变量有些麻烦，而且设置环境变量以后整个bash执行环境的http代理都会变为本地的privoxy，有些不方便。像proxychains那样使用privoxy，需要我们自己编写脚本解决，但是没关系，一句话就可以解决

```shell
http_proxy='http://127.0.0.1:8118' https_proxy='http://127.0.0.1:8118' $*
```

将其放入脚本文件中，比如ssproxy.sh，随后在/usr/bin/目录下创建该文件的软连接，添加可执行权限，使用的时候就可以向proxychains一样了（命令中的$*，代表将此脚本的所有参数当做命令执行）

```shell
ssproxy curl www.google.com
```

privoxy采用软件包管理工具安装的话，会自动在/etc/init.d安装启动脚本，实现开机自启动，无需认为干预



### 使用genpac生成pac文件实现国内直连，国外代理

----

genpac是一个用于将gfwlist转换为pac文件的python小工具，可以通过pip安装

```shell
pip install genpac --user
```

可以使用如下命令生成pac文件

```shell
genpac -p "SOCKS5 127.0.0.1:1080" --gfwlist-proxy="SOCKS5 127.0.0.1:1080" --gfwlist-url=https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt --output="config/autoproxy.pac"
```

在firefox浏览器中设置自动代理，指定pac文件的位置即可

```shell
file:///home/xiaozhi/config/autoproxy.pac
```

也可以在系统代理中选择自动代理，同样的设置pac文件的位置，在浏览器代理中选择系统代理



### ss服务器被封禁，使用socat做端口转发

----